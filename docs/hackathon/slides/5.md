# Macro for CBOR struct generation from `plutus.json`

We built a macro that generates Rust structs with CBOR (de)serialization from a `plutus.json` file. It was surprisingly trivial to implement (took 2 hours) for the example case. Extending it to support more complex cases would be trivial.

Pallas provides many of the primitives needs for parsing CBOR from the chain (unbound arrays, AnyUInt, etc.)

```rust
generate_cbor_struct!("blueprint/plutus.json");
```

The macro expands into the following:

```rust
type ByteArray = pallas::codec::utils::Bytes;
type VerificationKeyHash = pallas::codec::utils::Bytes;

#[derive(Debug, minicbor::Encode, minicbor::Decode, PartialEq, Clone)]
pub struct ActionValue {
    #[n(0)] pub supply_diff: Int,
    #[n(1)] pub q_tokens_diff: Int,
    #[n(2)] pub principal_diff: Int,
    #[n(3)] pub interest_diff: Int,
    #[n(4)] pub extra_interest_repaid: Int
}
type Int = pallas::codec::utils::AnyUInt;
```

```json
{
  "preamble": {
    "title": "liqwid-labs/hello_world",
    "description": "Aiken contracts for project 'liqwid-labs/hello_world'",
    "version": "0.0.0",
    "plutusVersion": "v3",
    "compiler": {
      "name": "Aiken",
      "version": "v1.1.9+2217206"
    },
    "license": "Apache-2.0"
  },
  "definitions": {
    "ByteArray": {
      "dataType": "bytes"
    },
    "Int": {
      "dataType": "integer"
    },
    "VerificationKeyHash": {
      "title": "VerificationKeyHash",
      "dataType": "bytes"
    },
    "liqwid/ActionValue": {
      "title": "ActionValue",
      "anyOf": [
        {
          "title": "ActionValue",
          "dataType": "constructor",
          "index": 0,
          "fields": [
            {
              "title": "supplyDiff",
              "$ref": "#/definitions/Int"
            },
            {
              "title": "qTokensDiff",
              "$ref": "#/definitions/Int"
            },
            {
              "title": "principalDiff",
              "$ref": "#/definitions/Int"
            },
            {
              "title": "interestDiff",
              "$ref": "#/definitions/Int"
            },
            {
              "title": "extraInterestRepaid",
              "$ref": "#/definitions/Int"
            }
          ]
        }
      ]
    }
  }
}
```
